{
  "hash": "221f0a3a49df0e169edd943c1d5fe18b",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"Classifying Fish with Fastai and ipywidgets\"\nauthor: \"Lindy Rauchenstein\"\ndate: \"2025-02-04\"\ncategories: [code, analysis]\nimage: \"angelfish.jpg\"\ntoc: true\nformat:\n  html:\n    code-fold: true\n    code-tools: true\n    ipywidgets: embed\n    embed-resources: true\n---\n\n\n\nWelcome, curious minds! Today, we’re going to build something cool: a simple fish classifier using Fastai and ipywidgets. Imagine you’re out fishing, and you catch something. Instead of scratching your head and wondering what it is, you can snap a photo, upload it here, and let our model tell you if it’s a reef fish, deepwater fish, or freshwater fish. Sound fun? Let’s dive in!\n\n![Angelfish live on coral reefs.](angelfish.jpg)\n\n## Setting Up the Environment\n\nFirst things first, we need to make sure we’re running this in the right environment. If you’re using the fastbook mamba environment, you’re good to go. If not, get that set up first.\n\n::: {#90cb8aa1 .cell execution_count=1}\n``` {.python .cell-code}\nfrom fastai.vision.widgets import FileUpload, Button, Output, Label, VBox\nfrom fastai.vision.core import *\nfrom fastbook import *\n```\n:::\n\n\nHere, we’re bringing in some tools from Fastai to help us build our classifier. These widgets will make it super easy for us to upload images and get predictions.\n\n## Creating the Upload and Button Widgets\n\nNow, we need a way for users (that’s you!) to interact with our classifier. We’ll create an upload button where you can drop your fish image, and a classification button to get results.\n\n::: {#0696433f .cell execution_count=2}\n``` {.python .cell-code}\nbtn_upload = widgets.FileUpload()\nbtn_run = widgets.Button(description='Classify')\nout_pl = widgets.Output()\nlbl_pred = widgets.Label()\n```\n:::\n\n\nThis is like setting up a little machine that takes in your image and spits out a prediction. The btn_upload is where you drop the image, btn_run is the button you press, out_pl is where we display the image, and lbl_pred will tell you what type of fish you’ve got.\n\n## Loading the Pre-Trained Model\n\nNow comes the real magic. We’re going to load our fish classifier model, which has already been trained and saved as export.pkl.\n\n::: {#eeeba1ff .cell execution_count=3}\n``` {.python .cell-code}\nlearn_inf = load_learner('export.pkl')\n```\n:::\n\n\nThink of this like a super-smart brain that has seen thousands of fish before and can now recognize them just by looking at a picture.\n\n## Writing the Classification Function\n\nWe need a function that tells our model to look at the uploaded image and predict the type of fish.\n\n::: {#4ed516f6 .cell execution_count=4}\n``` {.python .cell-code}\ndef on_click_classify(change):\n    out_pl.clear_output()\n    img = PILImage.create(btn_upload.value[0].content.tobytes())\n    with out_pl: display(img.to_thumb(128,128))\n    pred, pred_idx, probs = learn_inf.predict(img)\n    lbl_pred.value = f'Prediction: {pred}; Probability: {probs[pred_idx]:.04f}'\n```\n:::\n\n\nHere’s what happens step by step:\n\n1. We clear any previous output.\n2. We grab the image you uploaded.\n3. We show a small thumbnail preview of your fish.\n4. We pass the image through our smart model.\n5. The model tells us what kind of fish it is and how confident it is about the prediction.\n\n## Connecting the Button to the Function\n\nNow, we make sure that when you click the button, our function runs.\n\n::: {#ef89d473 .cell execution_count=5}\n``` {.python .cell-code}\nbtn_run.on_click(on_click_classify)\n```\n:::\n\n\nThis tells the button: \"Hey, whenever someone clicks you, go and classify that fish!\"\n\n## Displaying the Final Interface\n\nNow we put everything together into a nice interface that anyone can use.\n\n::: {#9619e0c5 .cell execution_count=6}\n``` {.python .cell-code}\nVBox([widgets.Label('Select your fish!'),\n      btn_upload, btn_run, out_pl, lbl_pred])\n```\n\n::: {.cell-output .cell-output-display execution_count=6}\n```{=html}\n<script type=\"application/vnd.jupyter.widget-view+json\">\n{\"model_id\":\"8f3759762e8c4eb9a29fd60b059b0c5b\",\"version_major\":2,\"version_minor\":0,\"quarto_mimetype\":\"application/vnd.jupyter.widget-view+json\"}\n</script>\n```\n:::\n:::\n\n\nThis arranges everything neatly on the screen so that users can easily upload their fish picture, click a button, and get an answer.\n\n## That’s It!\n\nCongratulations, you’ve built a working fish classifier! Now, go ahead and test it. Upload an image of a fish and let the model do its thing.\n\nWant to improve it? You could train the model on more fish species, add a confidence bar, or even build a mobile app version!\n\nKeep exploring, keep learning, and most importantly—have fun!\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n<script src=\"https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js\" crossorigin=\"anonymous\"></script>\n"
      ],
      "include-after-body": [
        "<script type=application/vnd.jupyter.widget-state+json>\n{\"state\":{\"0359ed149553471ab42b720d77f86786\":{\"model_module\":\"@jupyter-widgets/controls\",\"model_module_version\":\"2.0.0\",\"model_name\":\"ButtonModel\",\"state\":{\"_dom_classes\":[],\"_model_module\":\"@jupyter-widgets/controls\",\"_model_module_version\":\"2.0.0\",\"_model_name\":\"ButtonModel\",\"_view_count\":null,\"_view_module\":\"@jupyter-widgets/controls\",\"_view_module_version\":\"2.0.0\",\"_view_name\":\"ButtonView\",\"button_style\":\"\",\"description\":\"Classify\",\"disabled\":false,\"icon\":\"\",\"layout\":\"IPY_MODEL_8a0ac28783fa4addb0af41722c7e3916\",\"style\":\"IPY_MODEL_b0e9f8da0228423eb2f89987ff544a58\",\"tabbable\":null,\"tooltip\":null}},\"41dcebe8043149e7bdb79eb28336519a\":{\"model_module\":\"@jupyter-widgets/base\",\"model_module_version\":\"2.0.0\",\"model_name\":\"LayoutModel\",\"state\":{\"_model_module\":\"@jupyter-widgets/base\",\"_model_module_version\":\"2.0.0\",\"_model_name\":\"LayoutModel\",\"_view_count\":null,\"_view_module\":\"@jupyter-widgets/base\",\"_view_module_version\":\"2.0.0\",\"_view_name\":\"LayoutView\",\"align_content\":null,\"align_items\":null,\"align_self\":null,\"border_bottom\":null,\"border_left\":null,\"border_right\":null,\"border_top\":null,\"bottom\":null,\"display\":null,\"flex\":null,\"flex_flow\":null,\"grid_area\":null,\"grid_auto_columns\":null,\"grid_auto_flow\":null,\"grid_auto_rows\":null,\"grid_column\":null,\"grid_gap\":null,\"grid_row\":null,\"grid_template_areas\":null,\"grid_template_columns\":null,\"grid_template_rows\":null,\"height\":null,\"justify_content\":null,\"justify_items\":null,\"left\":null,\"margin\":null,\"max_height\":null,\"max_width\":null,\"min_height\":null,\"min_width\":null,\"object_fit\":null,\"object_position\":null,\"order\":null,\"overflow\":null,\"padding\":null,\"right\":null,\"top\":null,\"visibility\":null,\"width\":null}},\"59af9deec1e642d29a629c8146c60832\":{\"model_module\":\"@jupyter-widgets/controls\",\"model_module_version\":\"2.0.0\",\"model_name\":\"FileUploadModel\",\"state\":{\"_dom_classes\":[],\"_model_module\":\"@jupyter-widgets/controls\",\"_model_module_version\":\"2.0.0\",\"_model_name\":\"FileUploadModel\",\"_view_count\":null,\"_view_module\":\"@jupyter-widgets/controls\",\"_view_module_version\":\"2.0.0\",\"_view_name\":\"FileUploadView\",\"accept\":\"\",\"button_style\":\"\",\"description\":\"Upload\",\"description_allow_html\":false,\"disabled\":false,\"error\":\"\",\"icon\":\"upload\",\"layout\":\"IPY_MODEL_a44cd944071e4e96bc70a98b3575a5a1\",\"multiple\":false,\"style\":\"IPY_MODEL_b4ce9705062a45b5b0a46499f7bf26ea\",\"tabbable\":null,\"tooltip\":null,\"value\":[]}},\"6a6a6659f1fb48eea038dcea573ceb32\":{\"model_module\":\"@jupyter-widgets/controls\",\"model_module_version\":\"2.0.0\",\"model_name\":\"LabelModel\",\"state\":{\"_dom_classes\":[],\"_model_module\":\"@jupyter-widgets/controls\",\"_model_module_version\":\"2.0.0\",\"_model_name\":\"LabelModel\",\"_view_count\":null,\"_view_module\":\"@jupyter-widgets/controls\",\"_view_module_version\":\"2.0.0\",\"_view_name\":\"LabelView\",\"description\":\"\",\"description_allow_html\":false,\"layout\":\"IPY_MODEL_41dcebe8043149e7bdb79eb28336519a\",\"placeholder\":\"​\",\"style\":\"IPY_MODEL_cbbc3d5c78c841e38415f2397b3ec3c0\",\"tabbable\":null,\"tooltip\":null,\"value\":\"\"}},\"7ac6966e9af7440dbfc5f34ee339e2ba\":{\"model_module\":\"@jupyter-widgets/controls\",\"model_module_version\":\"2.0.0\",\"model_name\":\"LabelStyleModel\",\"state\":{\"_model_module\":\"@jupyter-widgets/controls\",\"_model_module_version\":\"2.0.0\",\"_model_name\":\"LabelStyleModel\",\"_view_count\":null,\"_view_module\":\"@jupyter-widgets/base\",\"_view_module_version\":\"2.0.0\",\"_view_name\":\"StyleView\",\"background\":null,\"description_width\":\"\",\"font_family\":null,\"font_size\":null,\"font_style\":null,\"font_variant\":null,\"font_weight\":null,\"text_color\":null,\"text_decoration\":null}},\"8a0ac28783fa4addb0af41722c7e3916\":{\"model_module\":\"@jupyter-widgets/base\",\"model_module_version\":\"2.0.0\",\"model_name\":\"LayoutModel\",\"state\":{\"_model_module\":\"@jupyter-widgets/base\",\"_model_module_version\":\"2.0.0\",\"_model_name\":\"LayoutModel\",\"_view_count\":null,\"_view_module\":\"@jupyter-widgets/base\",\"_view_module_version\":\"2.0.0\",\"_view_name\":\"LayoutView\",\"align_content\":null,\"align_items\":null,\"align_self\":null,\"border_bottom\":null,\"border_left\":null,\"border_right\":null,\"border_top\":null,\"bottom\":null,\"display\":null,\"flex\":null,\"flex_flow\":null,\"grid_area\":null,\"grid_auto_columns\":null,\"grid_auto_flow\":null,\"grid_auto_rows\":null,\"grid_column\":null,\"grid_gap\":null,\"grid_row\":null,\"grid_template_areas\":null,\"grid_template_columns\":null,\"grid_template_rows\":null,\"height\":null,\"justify_content\":null,\"justify_items\":null,\"left\":null,\"margin\":null,\"max_height\":null,\"max_width\":null,\"min_height\":null,\"min_width\":null,\"object_fit\":null,\"object_position\":null,\"order\":null,\"overflow\":null,\"padding\":null,\"right\":null,\"top\":null,\"visibility\":null,\"width\":null}},\"8f3759762e8c4eb9a29fd60b059b0c5b\":{\"model_module\":\"@jupyter-widgets/controls\",\"model_module_version\":\"2.0.0\",\"model_name\":\"VBoxModel\",\"state\":{\"_dom_classes\":[],\"_model_module\":\"@jupyter-widgets/controls\",\"_model_module_version\":\"2.0.0\",\"_model_name\":\"VBoxModel\",\"_view_count\":null,\"_view_module\":\"@jupyter-widgets/controls\",\"_view_module_version\":\"2.0.0\",\"_view_name\":\"VBoxView\",\"box_style\":\"\",\"children\":[\"IPY_MODEL_96bb625ec52a4c5cb0738ebaec5c94eb\",\"IPY_MODEL_59af9deec1e642d29a629c8146c60832\",\"IPY_MODEL_0359ed149553471ab42b720d77f86786\",\"IPY_MODEL_befd0242a4094a60827a6f4f0f046554\",\"IPY_MODEL_6a6a6659f1fb48eea038dcea573ceb32\"],\"layout\":\"IPY_MODEL_a99f45623c67467daee6f9c4f91e3942\",\"tabbable\":null,\"tooltip\":null}},\"96bb625ec52a4c5cb0738ebaec5c94eb\":{\"model_module\":\"@jupyter-widgets/controls\",\"model_module_version\":\"2.0.0\",\"model_name\":\"LabelModel\",\"state\":{\"_dom_classes\":[],\"_model_module\":\"@jupyter-widgets/controls\",\"_model_module_version\":\"2.0.0\",\"_model_name\":\"LabelModel\",\"_view_count\":null,\"_view_module\":\"@jupyter-widgets/controls\",\"_view_module_version\":\"2.0.0\",\"_view_name\":\"LabelView\",\"description\":\"\",\"description_allow_html\":false,\"layout\":\"IPY_MODEL_9d141feae6ba4bed8cf7ba000b556583\",\"placeholder\":\"​\",\"style\":\"IPY_MODEL_7ac6966e9af7440dbfc5f34ee339e2ba\",\"tabbable\":null,\"tooltip\":null,\"value\":\"Select your fish!\"}},\"9d141feae6ba4bed8cf7ba000b556583\":{\"model_module\":\"@jupyter-widgets/base\",\"model_module_version\":\"2.0.0\",\"model_name\":\"LayoutModel\",\"state\":{\"_model_module\":\"@jupyter-widgets/base\",\"_model_module_version\":\"2.0.0\",\"_model_name\":\"LayoutModel\",\"_view_count\":null,\"_view_module\":\"@jupyter-widgets/base\",\"_view_module_version\":\"2.0.0\",\"_view_name\":\"LayoutView\",\"align_content\":null,\"align_items\":null,\"align_self\":null,\"border_bottom\":null,\"border_left\":null,\"border_right\":null,\"border_top\":null,\"bottom\":null,\"display\":null,\"flex\":null,\"flex_flow\":null,\"grid_area\":null,\"grid_auto_columns\":null,\"grid_auto_flow\":null,\"grid_auto_rows\":null,\"grid_column\":null,\"grid_gap\":null,\"grid_row\":null,\"grid_template_areas\":null,\"grid_template_columns\":null,\"grid_template_rows\":null,\"height\":null,\"justify_content\":null,\"justify_items\":null,\"left\":null,\"margin\":null,\"max_height\":null,\"max_width\":null,\"min_height\":null,\"min_width\":null,\"object_fit\":null,\"object_position\":null,\"order\":null,\"overflow\":null,\"padding\":null,\"right\":null,\"top\":null,\"visibility\":null,\"width\":null}},\"a44cd944071e4e96bc70a98b3575a5a1\":{\"model_module\":\"@jupyter-widgets/base\",\"model_module_version\":\"2.0.0\",\"model_name\":\"LayoutModel\",\"state\":{\"_model_module\":\"@jupyter-widgets/base\",\"_model_module_version\":\"2.0.0\",\"_model_name\":\"LayoutModel\",\"_view_count\":null,\"_view_module\":\"@jupyter-widgets/base\",\"_view_module_version\":\"2.0.0\",\"_view_name\":\"LayoutView\",\"align_content\":null,\"align_items\":null,\"align_self\":null,\"border_bottom\":null,\"border_left\":null,\"border_right\":null,\"border_top\":null,\"bottom\":null,\"display\":null,\"flex\":null,\"flex_flow\":null,\"grid_area\":null,\"grid_auto_columns\":null,\"grid_auto_flow\":null,\"grid_auto_rows\":null,\"grid_column\":null,\"grid_gap\":null,\"grid_row\":null,\"grid_template_areas\":null,\"grid_template_columns\":null,\"grid_template_rows\":null,\"height\":null,\"justify_content\":null,\"justify_items\":null,\"left\":null,\"margin\":null,\"max_height\":null,\"max_width\":null,\"min_height\":null,\"min_width\":null,\"object_fit\":null,\"object_position\":null,\"order\":null,\"overflow\":null,\"padding\":null,\"right\":null,\"top\":null,\"visibility\":null,\"width\":null}},\"a99f45623c67467daee6f9c4f91e3942\":{\"model_module\":\"@jupyter-widgets/base\",\"model_module_version\":\"2.0.0\",\"model_name\":\"LayoutModel\",\"state\":{\"_model_module\":\"@jupyter-widgets/base\",\"_model_module_version\":\"2.0.0\",\"_model_name\":\"LayoutModel\",\"_view_count\":null,\"_view_module\":\"@jupyter-widgets/base\",\"_view_module_version\":\"2.0.0\",\"_view_name\":\"LayoutView\",\"align_content\":null,\"align_items\":null,\"align_self\":null,\"border_bottom\":null,\"border_left\":null,\"border_right\":null,\"border_top\":null,\"bottom\":null,\"display\":null,\"flex\":null,\"flex_flow\":null,\"grid_area\":null,\"grid_auto_columns\":null,\"grid_auto_flow\":null,\"grid_auto_rows\":null,\"grid_column\":null,\"grid_gap\":null,\"grid_row\":null,\"grid_template_areas\":null,\"grid_template_columns\":null,\"grid_template_rows\":null,\"height\":null,\"justify_content\":null,\"justify_items\":null,\"left\":null,\"margin\":null,\"max_height\":null,\"max_width\":null,\"min_height\":null,\"min_width\":null,\"object_fit\":null,\"object_position\":null,\"order\":null,\"overflow\":null,\"padding\":null,\"right\":null,\"top\":null,\"visibility\":null,\"width\":null}},\"b0e9f8da0228423eb2f89987ff544a58\":{\"model_module\":\"@jupyter-widgets/controls\",\"model_module_version\":\"2.0.0\",\"model_name\":\"ButtonStyleModel\",\"state\":{\"_model_module\":\"@jupyter-widgets/controls\",\"_model_module_version\":\"2.0.0\",\"_model_name\":\"ButtonStyleModel\",\"_view_count\":null,\"_view_module\":\"@jupyter-widgets/base\",\"_view_module_version\":\"2.0.0\",\"_view_name\":\"StyleView\",\"button_color\":null,\"font_family\":null,\"font_size\":null,\"font_style\":null,\"font_variant\":null,\"font_weight\":null,\"text_color\":null,\"text_decoration\":null}},\"b4ce9705062a45b5b0a46499f7bf26ea\":{\"model_module\":\"@jupyter-widgets/controls\",\"model_module_version\":\"2.0.0\",\"model_name\":\"ButtonStyleModel\",\"state\":{\"_model_module\":\"@jupyter-widgets/controls\",\"_model_module_version\":\"2.0.0\",\"_model_name\":\"ButtonStyleModel\",\"_view_count\":null,\"_view_module\":\"@jupyter-widgets/base\",\"_view_module_version\":\"2.0.0\",\"_view_name\":\"StyleView\",\"button_color\":null,\"font_family\":null,\"font_size\":null,\"font_style\":null,\"font_variant\":null,\"font_weight\":null,\"text_color\":null,\"text_decoration\":null}},\"befd0242a4094a60827a6f4f0f046554\":{\"model_module\":\"@jupyter-widgets/output\",\"model_module_version\":\"1.0.0\",\"model_name\":\"OutputModel\",\"state\":{\"_dom_classes\":[],\"_model_module\":\"@jupyter-widgets/output\",\"_model_module_version\":\"1.0.0\",\"_model_name\":\"OutputModel\",\"_view_count\":null,\"_view_module\":\"@jupyter-widgets/output\",\"_view_module_version\":\"1.0.0\",\"_view_name\":\"OutputView\",\"layout\":\"IPY_MODEL_c113a03a56a8445ca986b791c57eeb7e\",\"msg_id\":\"\",\"outputs\":[],\"tabbable\":null,\"tooltip\":null}},\"c113a03a56a8445ca986b791c57eeb7e\":{\"model_module\":\"@jupyter-widgets/base\",\"model_module_version\":\"2.0.0\",\"model_name\":\"LayoutModel\",\"state\":{\"_model_module\":\"@jupyter-widgets/base\",\"_model_module_version\":\"2.0.0\",\"_model_name\":\"LayoutModel\",\"_view_count\":null,\"_view_module\":\"@jupyter-widgets/base\",\"_view_module_version\":\"2.0.0\",\"_view_name\":\"LayoutView\",\"align_content\":null,\"align_items\":null,\"align_self\":null,\"border_bottom\":null,\"border_left\":null,\"border_right\":null,\"border_top\":null,\"bottom\":null,\"display\":null,\"flex\":null,\"flex_flow\":null,\"grid_area\":null,\"grid_auto_columns\":null,\"grid_auto_flow\":null,\"grid_auto_rows\":null,\"grid_column\":null,\"grid_gap\":null,\"grid_row\":null,\"grid_template_areas\":null,\"grid_template_columns\":null,\"grid_template_rows\":null,\"height\":null,\"justify_content\":null,\"justify_items\":null,\"left\":null,\"margin\":null,\"max_height\":null,\"max_width\":null,\"min_height\":null,\"min_width\":null,\"object_fit\":null,\"object_position\":null,\"order\":null,\"overflow\":null,\"padding\":null,\"right\":null,\"top\":null,\"visibility\":null,\"width\":null}},\"cbbc3d5c78c841e38415f2397b3ec3c0\":{\"model_module\":\"@jupyter-widgets/controls\",\"model_module_version\":\"2.0.0\",\"model_name\":\"LabelStyleModel\",\"state\":{\"_model_module\":\"@jupyter-widgets/controls\",\"_model_module_version\":\"2.0.0\",\"_model_name\":\"LabelStyleModel\",\"_view_count\":null,\"_view_module\":\"@jupyter-widgets/base\",\"_view_module_version\":\"2.0.0\",\"_view_name\":\"StyleView\",\"background\":null,\"description_width\":\"\",\"font_family\":null,\"font_size\":null,\"font_style\":null,\"font_variant\":null,\"font_weight\":null,\"text_color\":null,\"text_decoration\":null}}},\"version_major\":2,\"version_minor\":0}\n</script>\n"
      ]
    }
  }
}